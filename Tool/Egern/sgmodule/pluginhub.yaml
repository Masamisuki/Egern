name: 插件中心支持Egern(精修版)
description: 适配可莉(pluginhub)与LoonLab插件中心; 需ScriptHub模块.
author: Gemini

body_rewrites:
- response_regex:
    # 1. 处理可莉插件中心 (带loon://协议头)
    match: https?://pluginhub\.kelee\.one/.*list\.json
    find: loon://import\?plugin=(https://kelee\.one/Tool/Loon/Lpx/(.+?)\.lpx)
    replace: egern:///modules/new?url=http://script.hub/file/_start_/$1/_end_/$2.sgmodule%3Ftype%3Dloon-plugin%26target%3Dsurge-module%26del%3Dtrue%26jqEnabled%3Dtrue

- response_regex:
    # 2. 处理 LoonLab (直接匹配 https 链接)
    match: https?://loonlab\.103516\.xyz/.*list\.json
    # 这里的 $1 会匹配到 https://.../AppStoreMonitor.lpx
    # 这里的 $2 会匹配到 AppStoreMonitor
    find: (https?://loon\.103516\.xyz/Plugin/(.+?)\.lpx)
    replace: egern:///modules/new?url=http://script.hub/file/_start_/$1/_end_/$2.sgmodule%3Ftype%3Dloon-plugin%26target%3Dsurge-module%26del%3Dtrue%26jqEnabled%3Dtrue

mitm:
  hostnames:
    includes:
      - pluginhub.kelee.one
      - loonlab.103516.xyz
